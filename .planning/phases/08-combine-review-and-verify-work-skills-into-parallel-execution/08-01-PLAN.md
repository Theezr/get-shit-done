---
phase: 08-combine-review-and-verify-work-skills-into-parallel-execution
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/nick-review/SKILL.md
  - skills/nick-execute-phase/SKILL.md
autonomous: true

must_haves:
  truths:
    - "After wave execution, both verify-work and review agents are spawned simultaneously (parallel Task() calls)"
    - "User no longer needs to manually invoke /gsd:review -- it runs automatically in execute-phase Step 4.5"
    - "The orchestrator commits both REVIEW.md and RUNTIME-VERIFICATION.md after both agents complete (single commit on review PASS)"
    - "The review skill still works standalone via /gsd:review with its own commit-on-PASS gate"
    - "Non-frontend phases skip verify-work but still auto-run review"
    - "All 5 result combinations are explicitly handled in the orchestrator (PASS+passed, PASS+issues_found, PASS+inconclusive, PASS+N/A, FAIL+any)"
  artifacts:
    - path: "skills/nick-execute-phase/SKILL.md"
      provides: "Parallel verify+review in Step 4.5 with result matrix"
      contains: "Parallel Verify + Review"
    - path: "skills/nick-review/SKILL.md"
      provides: "Review skill decoupled from RUNTIME-VERIFICATION.md"
  key_links:
    - from: "skills/nick-execute-phase/SKILL.md"
      to: "nick-code-reviewer.md"
      via: "Task() spawn with DO NOT COMMIT instruction"
      pattern: "DO NOT COMMIT"
    - from: "skills/nick-execute-phase/SKILL.md"
      to: "nick-verify-work/SKILL.md"
      via: "Task() spawn in parallel with review"
      pattern: "nick-verify-work/SKILL.md"
    - from: "skills/nick-review/SKILL.md"
      to: "REVIEW.md"
      via: "standalone commit-on-PASS (unchanged)"
      pattern: "gsd-tools.cjs commit"
---

<objective>
Combine the review and verify-work skills into a single parallel step (Step 4.5) in the execute-phase orchestrator, and decouple the review skill from its soft RUNTIME-VERIFICATION.md dependency.

Purpose: Reduce post-execution wall-clock time from sequential (verify + review) to parallel (max of both), and eliminate the manual `/gsd:review` step by integrating it into the execute-phase pipeline.

Output: Updated execute-phase SKILL.md with parallel Step 4.5, updated review SKILL.md without RUNTIME-VERIFICATION dependency, both synced to installed locations.
</objective>

<execution_context>
@/Users/nick/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nick/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-combine-review-and-verify-work-skills-into-parallel-execution/08-RESEARCH.md
@.planning/phases/07-prototype-driven-design-in-plan-phase-and-mandatory-frontend-verification-after-execution/07-02-SUMMARY.md
@.planning/phases/03-verification-review-pipeline/03-02-SUMMARY.md
@skills/nick-execute-phase/SKILL.md
@skills/nick-review/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Decouple review skill from RUNTIME-VERIFICATION.md dependency</name>
  <files>
    skills/nick-review/SKILL.md
  </files>
  <action>
  Edit `skills/nick-review/SKILL.md` to remove the RUNTIME-VERIFICATION.md dependency from three locations:

  1. **Step 2 (Load Phase Context):** Remove the line:
     `- Read *-RUNTIME-VERIFICATION.md if it exists (include runtime findings in review context)`
     The review skill is orthogonal to runtime verification. It checks code quality, types, tests, and plan adherence. Runtime findings were always optional enrichment, never used for PASS/FAIL decisions.

  2. **Step 3 (Spawn Code Reviewer) files_to_read:** Remove the line:
     `- {phase_dir}/*-RUNTIME-VERIFICATION.md (if exists -- include runtime findings)`
     The code-reviewer agent does not need runtime findings to assess code quality.

  3. **Step 5 (Handle Result - PASS commit):** Change the commit command to only commit REVIEW.md:
     FROM: `--files {phase_dir}/{padded_phase}-REVIEW.md {phase_dir}/{padded_phase}-RUNTIME-VERIFICATION.md`
     TO: `--files {phase_dir}/{padded_phase}-REVIEW.md`
     When review runs standalone, it only owns its own output. When orchestrator runs review in parallel, the orchestrator owns the combined commit.

  Do NOT change any other behavior. The review skill must remain fully functional for standalone invocation via `/gsd:review`. Its Step 5 commit-on-PASS logic stays -- only the file list changes.

  After editing, sync to installed location:
  ```bash
  cp skills/nick-review/SKILL.md ~/.claude/skills/nick-review/SKILL.md
  ```
  </action>
  <verify>
  1. `grep -c "RUNTIME-VERIFICATION" skills/nick-review/SKILL.md` returns 0 (all references removed)
  2. `grep "gsd-tools.cjs commit" skills/nick-review/SKILL.md` still shows commit command (standalone commit preserved)
  3. `diff skills/nick-review/SKILL.md ~/.claude/skills/nick-review/SKILL.md` returns no output (files synced)
  </verify>
  <done>Review skill has zero references to RUNTIME-VERIFICATION.md. Standalone `/gsd:review` still works: spawns code-reviewer, reads result, commits REVIEW.md on PASS, blocks on FAIL. Repo and installed copies are identical.</done>
</task>

<task type="auto">
  <name>Task 2: Rewrite execute-phase Step 4.5 to parallel verify + review with result matrix</name>
  <files>
    skills/nick-execute-phase/SKILL.md
  </files>
  <action>
  Edit `skills/nick-execute-phase/SKILL.md` to replace the current Step 4.5 (auto-verify frontend only) with a new Step 4.5 that runs both verify-work AND review in parallel.

  **Replace the entire "## Step 4.5: Auto-Verify Frontend (conditional)" section** with the following structure:

  **Section header:** `## Step 4.5: Parallel Verify + Review`

  **Opening:** After all waves complete, run verification and review in parallel. This replaces the need for manual `/gsd:review` invocation.

  **Frontend detection:** Same as current -- check for `has_frontend: true` in plan frontmatter:
  ```bash
  HAS_FRONTEND=$(grep -l "has_frontend: true" "$PHASE_DIR"/*-PLAN.md 2>/dev/null | wc -l | tr -d ' ')
  ```

  **If HAS_FRONTEND > 0:** Spawn BOTH agents in parallel using two Task() calls in the same response:

  Inform user: "Running runtime verification and code review in parallel..."

  Task A (verify-work) -- same as current Step 4.5 Task spawn, unchanged:
  ```
  Task(
    prompt="First, read ~/.claude/skills/nick-verify-work/SKILL.md for the verification workflow.

    <objective>
    Auto-verify frontend work for phase {phase_number}-{phase_name}.
    Phase directory: {phase_dir}
    </objective>

    <files_to_read>
    - {phase_dir}/*-SUMMARY.md
    - {phase_dir}/*-PLAN.md
    </files_to_read>

    <output>Create {phase_dir}/{padded_phase}-RUNTIME-VERIFICATION.md</output>",
    subagent_type="general-purpose"
  )
  ```

  Task B (review) -- spawns the code-reviewer agent DIRECTLY (bypass review skill orchestrator to avoid nested orchestration and double commits):
  ```
  Task(
    prompt="First, read ~/.claude/skills/nick-review/references/agents/nick-code-reviewer.md for your role.

    <objective>
    Review code quality for phase {phase_number}-{phase_name}.
    Load relevant best-practice skills based on file patterns.
    Run IDE diagnostics and typecheck (belt-and-suspenders).
    Produce REVIEW.md with severity-graded findings.
    Determine PASS or FAIL.
    </objective>

    <files_to_read>
    - {phase_dir}/*-SUMMARY.md (all summaries -- identify files to review)
    - {phase_dir}/*-PLAN.md (all plans -- check plan adherence)
    </files_to_read>

    <output>Create {phase_dir}/{padded_phase}-REVIEW.md</output>

    <critical>DO NOT COMMIT. Leave committing to the orchestrator.</critical>",
    subagent_type="general-purpose"
  )
  ```

  **If HAS_FRONTEND = 0:** Spawn review ONLY (same Task B as above, no Task A):

  Inform user: "No frontend work detected. Running code review..."

  **After both tasks complete (or just review if no frontend), handle combined results:**

  Read REVIEW.md frontmatter for `result: PASS | FAIL`.
  Read RUNTIME-VERIFICATION.md frontmatter for `status: passed | issues_found | inconclusive` (if file exists).

  **Result matrix (ALL 5 combinations):**

  | Review Result | Verify Status | Action |
  |---------------|---------------|--------|
  | PASS | passed | Commit REVIEW.md + RUNTIME-VERIFICATION.md. Log "Review PASSED, runtime verified." |
  | PASS | issues_found | Commit REVIEW.md + RUNTIME-VERIFICATION.md. Display verify issues. Ask: "Runtime issues found. Address before phase goal verification?" |
  | PASS | inconclusive | Commit REVIEW.md only. Log "Review PASSED. Runtime verification inconclusive (Chrome DevTools unavailable)." |
  | PASS | N/A (no frontend) | Commit REVIEW.md only. Log "Review PASSED. No frontend -- runtime verification skipped." |
  | FAIL | any | Do NOT commit. Display review findings (Critical + High). Offer: "Fix issues and re-execute: `/gsd:execute-phase {X} --gaps`" |

  **Commit command (when review PASS):**
  Build the file list dynamically based on what exists:
  ```bash
  FILES="{phase_dir}/{padded_phase}-REVIEW.md"
  if [ -f "{phase_dir}/{padded_phase}-RUNTIME-VERIFICATION.md" ]; then
    FILES="$FILES {phase_dir}/{padded_phase}-RUNTIME-VERIFICATION.md"
  fi

  node ~/.claude/get-shit-done/bin/gsd-tools.cjs commit \
    "docs(phase-{X}): review PASSED -- code quality verified" \
    --files $FILES
  ```

  **IMPORTANT details:**
  - The review agent is spawned DIRECTLY using nick-code-reviewer.md (not the review skill orchestrator), to avoid nested orchestration and double commits. The `<critical>DO NOT COMMIT</critical>` instruction prevents the agent from committing.
  - Both Task() calls MUST appear in the same response block to run in parallel.
  - Step 5 (Verify Phase Goal) remains unchanged and sequential AFTER Step 4.5.
  - The existing Step 4.5 verify-work Task prompt is reused verbatim for Task A.

  After editing, sync to installed location:
  ```bash
  cp skills/nick-execute-phase/SKILL.md ~/.claude/skills/nick-execute-phase/SKILL.md
  ```
  </action>
  <verify>
  1. `grep "Parallel Verify + Review" skills/nick-execute-phase/SKILL.md` finds the new section header
  2. `grep "Auto-Verify Frontend" skills/nick-execute-phase/SKILL.md` returns nothing (old section replaced)
  3. `grep "DO NOT COMMIT" skills/nick-execute-phase/SKILL.md` finds the critical instruction for review agent
  4. `grep "nick-code-reviewer.md" skills/nick-execute-phase/SKILL.md` confirms direct agent spawning (not review SKILL.md)
  5. `grep -c "PASS.*passed\|PASS.*issues_found\|PASS.*inconclusive\|PASS.*N/A\|FAIL.*any" skills/nick-execute-phase/SKILL.md` returns 5 (all result matrix rows present)
  6. `grep "Step 5: Verify Phase Goal" skills/nick-execute-phase/SKILL.md` still exists (unchanged)
  7. `diff skills/nick-execute-phase/SKILL.md ~/.claude/skills/nick-execute-phase/SKILL.md` returns no output (files synced)
  </verify>
  <done>Execute-phase Step 4.5 spawns verify-work and review in parallel (or review-only for non-frontend phases). All 5 result combinations are handled. The orchestrator owns the commit gate. Step 5 (phase goal verification) is unchanged. Repo and installed copies are identical.</done>
</task>

</tasks>

<verification>
1. Review skill standalone: `grep -c "RUNTIME-VERIFICATION" skills/nick-review/SKILL.md` = 0
2. Review skill commit preserved: `grep "gsd-tools.cjs commit" skills/nick-review/SKILL.md` shows commit line
3. Execute-phase parallel: `grep "Parallel Verify + Review" skills/nick-execute-phase/SKILL.md` matches
4. Old step gone: `grep "Auto-Verify Frontend" skills/nick-execute-phase/SKILL.md` returns nothing
5. Direct reviewer spawn: `grep "nick-code-reviewer.md" skills/nick-execute-phase/SKILL.md` matches
6. DO NOT COMMIT: `grep "DO NOT COMMIT" skills/nick-execute-phase/SKILL.md` matches
7. Step 5 intact: `grep "Step 5: Verify Phase Goal" skills/nick-execute-phase/SKILL.md` matches
8. Repo-installed sync (review): `diff skills/nick-review/SKILL.md ~/.claude/skills/nick-review/SKILL.md` = empty
9. Repo-installed sync (execute): `diff skills/nick-execute-phase/SKILL.md ~/.claude/skills/nick-execute-phase/SKILL.md` = empty
</verification>

<success_criteria>
- Execute-phase Step 4.5 spawns verify-work and review agents in parallel (two Task() calls in one response)
- Non-frontend phases spawn review only (no verify-work)
- All 5 result combinations (PASS+passed, PASS+issues_found, PASS+inconclusive, PASS+N/A, FAIL+any) are explicitly handled
- Review skill has zero references to RUNTIME-VERIFICATION.md
- Review skill standalone mode still works (commit-on-PASS preserved)
- Orchestrator commits both artifacts after parallel completion (single atomic commit)
- Direct code-reviewer agent spawn with DO NOT COMMIT instruction
- Step 5 (phase goal verification) unchanged and sequential after Step 4.5
- Both modified files synced to ~/.claude/skills/ installed location
</success_criteria>

<output>
After completion, create `.planning/phases/08-combine-review-and-verify-work-skills-into-parallel-execution/08-01-SUMMARY.md`
</output>
