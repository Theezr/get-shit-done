---
phase: 03-verification-review-pipeline
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/gsd-verify-work/SKILL.md
  - skills/gsd-verify-work/references/agents/gsd-browser-tester.md
autonomous: true

must_haves:
  truths:
    - "gsd-verify-work skill exists with YAML frontmatter (name, description, argument-hint, allowed-tools) following Phase 1/2 SKILL.md pattern"
    - "Verify skill's allowed-tools includes all Chrome DevTools MCP tools but excludes Edit (PIPE-04: verifier never modifies source)"
    - "Browser-tester agent implements snapshot-interact-verify testing cycle using Chrome DevTools MCP tools"
    - "Verify skill writes VERIFICATION.md report with runtime findings (type: runtime) -- distinct from existing goal-backward VERIFICATION.md"
    - "Verify skill handles Chrome DevTools unavailability gracefully (pre-flight list_pages check, inconclusive status, not blocked)"
  artifacts:
    - path: "skills/gsd-verify-work/SKILL.md"
      provides: "Verify-work orchestrator with Chrome DevTools MCP integration"
      min_lines: 60
    - path: "skills/gsd-verify-work/references/agents/gsd-browser-tester.md"
      provides: "Runtime testing agent with snapshot-interact-verify protocol"
      min_lines: 100
  key_links:
    - from: "skills/gsd-verify-work/SKILL.md"
      to: "skills/gsd-verify-work/references/agents/gsd-browser-tester.md"
      via: "Task spawn prompt referencing agent path"
      pattern: "gsd-verify-work/references/agents/gsd-browser-tester"
    - from: "skills/gsd-verify-work/SKILL.md"
      to: "gsd-tools.js"
      via: "init phase-op call"
      pattern: "gsd-tools\\.js.*init"
    - from: "skills/gsd-verify-work/references/agents/gsd-browser-tester.md"
      to: "Chrome DevTools MCP"
      via: "tool references in testing protocol"
      pattern: "mcp__chrome-devtools__"
---

<objective>
Create the gsd-verify-work skill with SKILL.md orchestrator and browser-tester agent definition.

Purpose: This skill completes the "verify" stage of the plan-execute-verify-review pipeline (PIPE-01). It performs runtime testing of the running application using Chrome DevTools MCP -- distinct from the existing gsd-verifier which does goal-backward codebase verification. Satisfies SKILL-03, MCP-06, and PIPE-04.

Output: `skills/gsd-verify-work/SKILL.md` + `skills/gsd-verify-work/references/agents/gsd-browser-tester.md` (repo source copies). Installed copies at `~/.claude/skills/gsd-verify-work/`.
</objective>

<execution_context>
@/Users/nick/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nick/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-verification-review-pipeline/03-RESEARCH.md

Reference implementations and established patterns:
@skills/gsd-execute-phase/SKILL.md (established SKILL.md orchestrator pattern)
@skills/gsd-execute-phase/references/agents/gsd-verifier.md (existing goal-backward verifier -- this is NOT the same as the new runtime verifier)
@docs/nick/verify.md (user's reference verify skill -- adapt patterns from this)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create gsd-verify-work SKILL.md orchestrator</name>
  <files>skills/gsd-verify-work/SKILL.md</files>
  <action>
Create `skills/gsd-verify-work/SKILL.md` following the established SKILL.md pattern from Phase 1/2.

**Frontmatter** (YAML between --- delimiters):
- `name: gsd-verify-work`
- `description:` Multi-line description mentioning Chrome DevTools runtime testing, snapshot-interact-verify pattern. Trigger phrases: "verify work", "test phase", "/gsd:verify-work", or after execute-phase completes.
- `argument-hint: "<phase-number>"`
- `allowed-tools:` Include Read, Write, Bash, Glob, Grep, Task, and ALL Chrome DevTools MCP tools (take_snapshot, take_screenshot, navigate_page, list_pages, select_page, list_console_messages, get_console_message, list_network_requests, get_network_request, evaluate_script, performance_start_trace, performance_stop_trace, performance_analyze_insight, click, fill, hover, press_key, emulate, wait_for). Do NOT include Edit tool (enforces PIPE-04: verifier never modifies source).

**Body** (lean orchestrator, ~80-120 lines, following gsd-execute-phase SKILL.md as template):

Step 1: Initialize
- `INIT=$(node ~/.claude/get-shit-done/bin/gsd-tools.js init phase-op "$PHASE_ARG")`
- Parse: phase_dir, phase_number, phase_name, padded_phase
- Error if phase not found

Step 2: Load Phase Context
- Read SUMMARY.md files from phase directory to understand what was built
- Read PLAN.md files for must_haves (expected behaviors)
- Determine testable features: URLs, routes, API endpoints, UI interactions

Step 3: Pre-flight Check
- Attempt `mcp__chrome-devtools__list_pages` to verify Chrome DevTools MCP is connected
- If unavailable: report "Chrome DevTools MCP not connected -- runtime verification skipped", set status to "inconclusive", offer user to skip or retry
- If available: proceed

Step 4: Spawn Browser Tester
- Use Task tool to spawn browser-tester agent
- Prompt pattern: "First, read ~/.claude/skills/gsd-verify-work/references/agents/gsd-browser-tester.md for your role."
- Pass phase info in `<objective>` tags
- Pass file paths in `<files_to_read>` tags (SUMMARY.md, PLAN.md, ROADMAP.md) -- NOT content
- Output instruction: Create `{phase_dir}/{padded_phase}-RUNTIME-VERIFICATION.md`
- Use `subagent_type="general-purpose"`

Step 5: Handle Result
- Read status from RUNTIME-VERIFICATION.md frontmatter
- **passed:** Display summary, offer `/gsd:review {phase}`
- **issues_found:** Display issues, offer re-execution or proceed to review
- **inconclusive:** Chrome DevTools unavailable or app not running, offer skip

Step 6: Present Results and Offer Next
- Display verification summary table
- Offer `/gsd:review {phase}` as next step

**Key design decisions:**
- Output file named `XX-RUNTIME-VERIFICATION.md` (not `XX-VERIFICATION.md`) to avoid collision with existing goal-backward VERIFICATION.md from gsd-verifier
- No Edit tool in allowed-tools enforces PIPE-04 (verifier never modifies source files)
- Pre-flight check prevents blocking the pipeline when Chrome is not running
- The skill is OPTIONAL for non-UI phases (handles gracefully)
  </action>
  <verify>
File exists at `skills/gsd-verify-work/SKILL.md`. File starts with YAML frontmatter containing `name: gsd-verify-work`. Frontmatter includes `allowed-tools` with Chrome DevTools MCP tools. Frontmatter does NOT contain `Edit` in allowed-tools. Body contains init step using gsd-tools.js. Body contains Task spawn referencing `gsd-browser-tester.md`. Body references `RUNTIME-VERIFICATION.md` as output filename.
  </verify>
  <done>
SKILL.md exists with correct frontmatter (name, description, argument-hint, allowed-tools with Chrome DevTools tools, no Edit), lean orchestrator body (~80-120 lines) with 6 steps (init, load context, pre-flight, spawn tester, handle result, present), and path-based agent spawning pattern matching Phase 1/2 skills.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create gsd-browser-tester agent definition</name>
  <files>skills/gsd-verify-work/references/agents/gsd-browser-tester.md</files>
  <action>
Create `skills/gsd-verify-work/references/agents/gsd-browser-tester.md` following the established agent definition pattern from gsd-executor.md and gsd-verifier.md.

**Frontmatter:**
```yaml
---
name: gsd-browser-tester
description: Runtime verification agent using Chrome DevTools MCP. Performs snapshot-interact-verify testing on the running application. Does NOT modify source files.
tools: Read, Bash, Grep, Glob, mcp__chrome-devtools__*
color: cyan
---
```

**Structure** (adapt from docs/nick/verify.md reference implementation and the agent definition pattern from gsd-verifier.md):

`<role>` section:
- Runtime verifier that tests the running application via Chrome DevTools MCP
- Does NOT modify source files, does NOT review code quality, does NOT commit
- Only tests runtime behavior and reports findings

`<testing_protocol>` section -- the Snapshot-Interact-Verify Cycle:
For each feature to verify:
1. Navigate: `navigate_page` to the feature URL
2. Snapshot: `take_snapshot` to capture initial DOM state
3. Inspect: Check snapshot for expected elements, content, structure
4. Interact: `click`, `fill`, `press_key` as needed for the workflow
5. Re-snapshot: `take_snapshot` after interaction
6. Verify: Check post-interaction state matches expected behavior
7. Console: `list_console_messages` with types: ["error", "warn"]
8. Network: `list_network_requests` to verify API calls
9. Performance: `performance_start_trace` + `performance_stop_trace` + `performance_analyze_insight`

Standard checks for every page:
- Zero console errors (warnings documented but not blocking)
- API responses return expected status codes (check with `get_network_request`)
- No long tasks >50ms in performance trace
- Page loads cleanly without layout shifts
- Interactive elements respond to input

`<execution_flow>` section:
Step 1: Read SUMMARY.md files to understand what was built (features, files, URLs)
Step 2: Read PLAN.md must_haves to understand expected behaviors
Step 3: Derive test plan -- list of features with URLs and expected behaviors
Step 4: For each feature, execute the testing cycle
Step 5: Compile results into RUNTIME-VERIFICATION.md

`<report_output>` section -- RUNTIME-VERIFICATION.md structure:
Frontmatter with:
```yaml
---
phase: XX-name
verified: YYYY-MM-DDTHH:MM:SSZ
type: runtime
status: passed | issues_found | inconclusive
chrome_devtools: connected | unavailable
tests:
  total: N
  passed: N
  failed: N
  skipped: N
console_errors: N
network_issues: N
performance_long_tasks: N
---
```

Body sections: Status, Test Results (table per feature with test/status/evidence), Console Inspection, Network Inspection, Performance, Issues Found, Summary.

`<critical_rules>` section:
- NEVER modify source files (no Write to source paths, no Edit)
- NEVER commit (leave to orchestrator/reviewer)
- Environment issues (app not running, MCP disconnected) = "inconclusive", not "failed"
- Be specific: describe what passed and what failed with evidence from snapshots
- If app is not running, do not hang -- report inconclusive immediately

`<non_ui_handling>` section:
- For phases that produce no UI (like this GSD customization project), the tester should detect this from SUMMARY.md (no .tsx/.jsx files, no routes, no URLs)
- Report "N/A -- no runtime component in this phase" with status "inconclusive"
- This is normal, not an error

`<success_criteria>` section:
- [ ] All testable features identified from SUMMARY.md
- [ ] Each feature tested with snapshot-interact-verify cycle
- [ ] Console errors checked on every page
- [ ] Network requests verified
- [ ] Performance trace run
- [ ] RUNTIME-VERIFICATION.md created with structured report
- [ ] Results returned to orchestrator (NOT committed)

**Agent should be ~150-250 lines** total, following the density level of gsd-verifier.md (~523 lines for a more complex agent) but scaled down since the testing protocol is simpler than goal-backward verification.
  </action>
  <verify>
File exists at `skills/gsd-verify-work/references/agents/gsd-browser-tester.md`. File starts with YAML frontmatter containing `name: gsd-browser-tester`. File contains `<testing_protocol>` section with snapshot-interact-verify cycle steps. File contains `<report_output>` section with RUNTIME-VERIFICATION.md template. File does NOT contain any Edit or Write-to-source instructions. File contains `<critical_rules>` with "NEVER modify source files".
  </verify>
  <done>
gsd-browser-tester.md exists with correct frontmatter, testing protocol with snapshot-interact-verify cycle, RUNTIME-VERIFICATION.md template, non-UI handling, critical rules enforcing read-only behavior, and success criteria. Agent follows established pattern from gsd-verifier.md.
  </done>
</task>

<task type="auto">
  <name>Task 3: Install skill to ~/.claude/skills/ and verify structure</name>
  <files>skills/gsd-verify-work/SKILL.md, skills/gsd-verify-work/references/agents/gsd-browser-tester.md</files>
  <action>
Copy the repo source skill to the installed location, matching the pattern established in Phase 1:

1. Create directory structure:
```bash
mkdir -p ~/.claude/skills/gsd-verify-work/references/agents/
```

2. Copy files:
```bash
cp skills/gsd-verify-work/SKILL.md ~/.claude/skills/gsd-verify-work/SKILL.md
cp skills/gsd-verify-work/references/agents/gsd-browser-tester.md ~/.claude/skills/gsd-verify-work/references/agents/gsd-browser-tester.md
```

3. Verify installed structure:
```bash
ls -la ~/.claude/skills/gsd-verify-work/
ls -la ~/.claude/skills/gsd-verify-work/references/agents/
```

4. Verify SKILL.md frontmatter is valid:
```bash
head -5 ~/.claude/skills/gsd-verify-work/SKILL.md
```

5. Verify PIPE-04 enforcement: grep allowed-tools section and confirm Edit is NOT present:
```bash
grep -A 30 "allowed-tools:" ~/.claude/skills/gsd-verify-work/SKILL.md | grep -c "Edit"
# Should return 0
```

6. Verify Chrome DevTools tools are present:
```bash
grep -c "mcp__chrome-devtools__" ~/.claude/skills/gsd-verify-work/SKILL.md
# Should return 19+ (all Chrome DevTools tools)
```
  </action>
  <verify>
`~/.claude/skills/gsd-verify-work/SKILL.md` exists. `~/.claude/skills/gsd-verify-work/references/agents/gsd-browser-tester.md` exists. `grep -c "Edit" ~/.claude/skills/gsd-verify-work/SKILL.md` returns 0 in allowed-tools context. `grep -c "mcp__chrome-devtools__" ~/.claude/skills/gsd-verify-work/SKILL.md` returns 19 or more.
  </verify>
  <done>
gsd-verify-work skill installed at ~/.claude/skills/ with correct directory structure. SKILL.md has all Chrome DevTools MCP tools in allowed-tools. Edit tool is NOT in allowed-tools (PIPE-04). Browser-tester agent is accessible at the path referenced in SKILL.md Task spawn prompt.
  </done>
</task>

</tasks>

<verification>
1. `skills/gsd-verify-work/SKILL.md` exists with valid YAML frontmatter (name, description, argument-hint, allowed-tools)
2. `skills/gsd-verify-work/references/agents/gsd-browser-tester.md` exists with valid agent frontmatter
3. SKILL.md follows lean orchestrator pattern (~80-120 lines body)
4. SKILL.md allowed-tools includes all 19 Chrome DevTools MCP tools
5. SKILL.md allowed-tools does NOT include Edit (PIPE-04)
6. Browser-tester agent includes snapshot-interact-verify testing protocol
7. Browser-tester agent writes RUNTIME-VERIFICATION.md (not VERIFICATION.md)
8. Browser-tester agent has critical rules forbidding source file modification
9. Installed copies exist at ~/.claude/skills/gsd-verify-work/
10. SKILL.md references agent via absolute path (~/.claude/skills/gsd-verify-work/references/agents/gsd-browser-tester.md)
</verification>

<success_criteria>
- SKILL-03 satisfied: verify skill performs Chrome DevTools runtime testing with snapshot-interact-verify pattern
- MCP-06 satisfied: browser-tester agent uses all Chrome DevTools MCP tools (navigate, snapshot, click, fill, console, network, performance)
- PIPE-04 satisfied: verify skill's allowed-tools excludes Edit; agent critical rules forbid source modification
- Skill follows established SKILL.md architecture from Phase 1/2 (lean body, agents in references/, path-based context passing)
- Both repo source (skills/) and installed (~/.claude/skills/) copies exist
</success_criteria>

<output>
After completion, create `.planning/phases/03-verification-review-pipeline/03-01-SUMMARY.md`
</output>
