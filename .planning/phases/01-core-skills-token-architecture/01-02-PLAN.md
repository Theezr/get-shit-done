---
phase: 01-core-skills-token-architecture
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - ~/.claude/skills/gsd-execute-phase/SKILL.md
  - ~/.claude/skills/gsd-execute-phase/references/agents/gsd-executor.md
  - ~/.claude/skills/gsd-execute-phase/references/agents/gsd-verifier.md
autonomous: true

must_haves:
  truths:
    - "Invoking /gsd:execute-phase triggers the new SKILL.md skill, not the old command"
    - "Execute-phase skill spawns executor and verifier agents from references/agents/ using absolute paths"
    - "Executor agents receive plan file paths and read plans themselves (no content injection by orchestrator)"
    - "SKILL.md body is under 1,500 tokens of orchestration logic"
    - "Execute-phase orchestrator lists explicit allowed-tools in frontmatter (PIPE-06)"
    - "Execute-phase orchestrator never reads agent output files (follows security-review lean pattern)"
  artifacts:
    - path: "~/.claude/skills/gsd-execute-phase/SKILL.md"
      provides: "Execute-phase orchestrator skill"
      contains: "name: gsd-execute-phase"
    - path: "~/.claude/skills/gsd-execute-phase/references/agents/gsd-executor.md"
      provides: "Executor agent definition"
      contains: "gsd-executor"
    - path: "~/.claude/skills/gsd-execute-phase/references/agents/gsd-verifier.md"
      provides: "Verifier agent definition"
      contains: "gsd-verifier"
  key_links:
    - from: "~/.claude/skills/gsd-execute-phase/SKILL.md"
      to: "references/agents/gsd-executor.md"
      via: "Task prompt with absolute path"
      pattern: "~/.claude/skills/gsd-execute-phase/references/agents/gsd-executor.md"
    - from: "~/.claude/skills/gsd-execute-phase/SKILL.md"
      to: "references/agents/gsd-verifier.md"
      via: "Task prompt with absolute path"
      pattern: "~/.claude/skills/gsd-execute-phase/references/agents/gsd-verifier.md"
    - from: "gsd-executor.md"
      to: "execute-plan.md workflow"
      via: "execution_context reference"
      pattern: "/Users/nick/.claude/get-shit-done/workflows/execute-plan.md"
---

<objective>
Create the gsd-execute-phase skill as a proper SKILL.md with frontmatter, lean orchestrator body, and agent definitions in references/agents/.

Purpose: Convert execute-phase from a command+workflow architecture (339 lines, mixed content/path passing) to a SKILL.md architecture (lean body + references/) with consistent path-based context passing. This satisfies SKILL-02, SKILL-05 (execute-phase agents), TOKEN-01, TOKEN-02, and PIPE-06. PIPE-03 is structurally prepared (allowed-tools on orchestrator) but full enforcement deferred to Phase 3 (review skill).

Output: `~/.claude/skills/gsd-execute-phase/` directory with SKILL.md and 2 agent definitions in references/agents/.
</objective>

<execution_context>
@/Users/nick/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nick/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-core-skills-token-architecture/01-RESEARCH.md

Source files to convert:
@/Users/nick/.claude/get-shit-done/workflows/execute-phase.md

Existing agent definitions to move:
@/Users/nick/.claude/agents/gsd-executor.md
@/Users/nick/.claude/agents/gsd-verifier.md

Reference skill for pattern:
@/Users/nick/.claude/skills/security-review/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create gsd-execute-phase SKILL.md with frontmatter and lean orchestrator body</name>
  <files>~/.claude/skills/gsd-execute-phase/SKILL.md</files>
  <action>
Create the directory `~/.claude/skills/gsd-execute-phase/` and write SKILL.md.

**Frontmatter (YAML):**
```yaml
name: gsd-execute-phase
description: >
  Execute all plans in a phase with wave-based parallel agents. Spawns executor
  agents per plan and a verifier agent for phase goal checking. Use when user
  says "execute phase", "run phase", "build phase", "/gsd:execute-phase", or
  wants to execute a planned phase. Requires planned phase with PLAN.md files.
argument-hint: "<phase-number> [--gaps-only]"
allowed-tools:
  - Read
  - Write
  - Edit
  - Glob
  - Grep
  - Bash
  - Task
```

NOTE: The orchestrator has Edit and Bash but does NOT use them for code implementation -- it uses them for state management (STATE.md updates, ROADMAP.md marking). The actual code implementation happens inside executor agents (spawned via Task), which get their own tool access.

**Body structure (~100-150 lines, target <1,500 tokens):**

The body must be a lean orchestration sequence. Do NOT copy the full workflow file (339 lines). Extract only the orchestration logic:

1. **Initialize** -- `gsd-tools.cjs init execute-phase "$PHASE"`. Parse: executor_model, verifier_model, phase_dir, plans, incomplete_plans, parallelization, branching_strategy, branch_name.

2. **Handle Branching** -- If branching_strategy is "phase" or "milestone", checkout branch using branch_name from init.

3. **Discover and Group Plans** -- `gsd-tools.cjs phase-plan-index "$PHASE"`. Parse wave grouping. Filter: skip plans with has_summary=true, apply --gaps-only filter. Display execution plan table.

4. **Execute Waves** -- For each wave in sequence:
   a. Describe what's being built (read plan objectives)
   b. Spawn executor agents (parallel if parallelization=true, sequential if false):
      ```
      Task(
        prompt="First, read ~/.claude/skills/gsd-execute-phase/references/agents/gsd-executor.md for your role.

        <objective>
        Execute plan {plan_id} of phase {phase_number}-{phase_name}.
        Commit each task atomically. Create SUMMARY.md. Update STATE.md.
        </objective>

        <execution_context>
        Read these workflow files for execution instructions:
        - /Users/nick/.claude/get-shit-done/workflows/execute-plan.md
        - /Users/nick/.claude/get-shit-done/templates/summary.md
        - /Users/nick/.claude/get-shit-done/references/checkpoints.md
        - /Users/nick/.claude/get-shit-done/references/tdd.md
        </execution_context>

        <files_to_read>
        - Plan: {phase_dir}/{plan_file}
        - State: .planning/STATE.md
        - Config: .planning/config.json (if exists)
        </files_to_read>",
        subagent_type="general-purpose"
      )
      ```
   c. Wait for all agents in wave to complete
   d. Spot-check: verify SUMMARY.md exists, git commits present, no Self-Check: FAILED
   e. Handle failures: ask user to retry or continue
   f. Handle checkpoint plans (autonomous: false) between waves

5. **Verify Phase Goal** -- Spawn verifier:
   ```
   Task(
     prompt="First, read ~/.claude/skills/gsd-execute-phase/references/agents/gsd-verifier.md for your role.

     <objective>
     Verify phase {phase_number} achieved its goal.
     Phase directory: {phase_dir}
     Phase goal: {goal}
     </objective>

     <files_to_read>
     - {phase_dir}/*-PLAN.md (all plans for must_haves)
     - {phase_dir}/*-SUMMARY.md (all summaries)
     - .planning/ROADMAP.md (phase goal)
     </files_to_read>

     <output>Create {phase_dir}/{padded_phase}-VERIFICATION.md</output>",
     subagent_type="general-purpose"
   )
   ```

6. **Update Roadmap** -- Mark phase complete or report gaps. Commit via gsd-tools.cjs.

7. **Offer Next** -- Next phase or milestone complete.

**Critical rules for the body:**
- The existing execute-phase.md ALREADY uses path-based passing for executors (line 99: "Pass paths only"). Preserve this pattern.
- Orchestrator NEVER reads SUMMARY.md content (spot-checks existence only, per security-review pattern)
- All Task prompts use ABSOLUTE paths to references/agents/
- The executor agents still reference execute-plan.md, summary.md, checkpoints.md, tdd.md from `~/.claude/get-shit-done/` -- these shared references are NOT moved in Phase 1
- Checkpoint handling: agent returns structured state, orchestrator presents to user, spawns fresh continuation agent
- Known classifyHandoffIfNeeded bug handling preserved
  </action>
  <verify>
1. `[ -f ~/.claude/skills/gsd-execute-phase/SKILL.md ]` -- file exists
2. `head -20 ~/.claude/skills/gsd-execute-phase/SKILL.md` -- has frontmatter with name, description, allowed-tools
3. `wc -w ~/.claude/skills/gsd-execute-phase/SKILL.md` -- under 1,500 words
4. `grep "references/agents/gsd-executor.md" ~/.claude/skills/gsd-execute-phase/SKILL.md` -- absolute path reference exists
5. `grep "references/agents/gsd-verifier.md" ~/.claude/skills/gsd-execute-phase/SKILL.md` -- absolute path reference exists
6. `grep "execute-plan.md" ~/.claude/skills/gsd-execute-phase/SKILL.md` -- references shared workflow
  </verify>
  <done>
SKILL.md exists at ~/.claude/skills/gsd-execute-phase/SKILL.md with: YAML frontmatter (name: gsd-execute-phase, allowed-tools), lean body under 1,500 tokens, 7 orchestration steps, all agent spawns use absolute paths to references/agents/, executor agents receive plan paths (not content).
  </done>
</task>

<task type="auto">
  <name>Task 2: Copy and adapt agent definitions to references/agents/</name>
  <files>
~/.claude/skills/gsd-execute-phase/references/agents/gsd-executor.md
~/.claude/skills/gsd-execute-phase/references/agents/gsd-verifier.md
  </files>
  <action>
Create directory `~/.claude/skills/gsd-execute-phase/references/agents/` and copy the 2 agent definitions.

**For each agent file:**

1. **gsd-executor.md** (422 lines):
   - Copy from `~/.claude/agents/gsd-executor.md`
   - The executor's core job is: read plan, execute tasks, commit per-task, create SUMMARY.md, update STATE.md
   - Verify it references execute-plan.md workflow by absolute path (`/Users/nick/.claude/get-shit-done/workflows/execute-plan.md`)
   - The executor currently commits per-task -- this is KEPT in Phase 1. Full PIPE-03 (executor never commits, reviewer does) is deferred to Phase 3. Do NOT remove commit logic.
   - Remove any patterns where executor expects plan content in its spawn prompt -- it should read the plan file from the path provided
   - Ensure the executor reads `<execution_context>` files (execute-plan.md, summary.md, checkpoints.md, tdd.md) via Read tool at execution start

2. **gsd-verifier.md** (523 lines):
   - Copy from `~/.claude/agents/gsd-verifier.md`
   - The verifier checks phase goal achievement against must_haves in PLAN.md files
   - It creates VERIFICATION.md with status (passed | human_needed | gaps_found)
   - Update to read plan files and summary files from paths provided in spawn prompt
   - Do NOT change verification methodology or output format

**Key adaptations for both agents:**
- Remove patterns that assume content is injected in spawn prompt
- Add "Read these files at execution start" if not present
- Ensure gsd-tools.cjs referenced by full path: `/Users/nick/.claude/get-shit-done/bin/gsd-tools.cjs`
- Preserve all core logic: deviation rules, commit protocol, checkpoint handling (executor), verification dimensions (verifier)

**What NOT to change:**
- The executor's deviation rules, TDD execution, checkpoint protocol, commit format
- The verifier's must_haves checking, truth verification, gap detection methodology
- References to shared files (execute-plan.md, summary.md, etc.) -- these stay at `~/.claude/get-shit-done/`
- The executor's per-task commit behavior (PIPE-03 deferred to Phase 3)
  </action>
  <verify>
1. `[ -f ~/.claude/skills/gsd-execute-phase/references/agents/gsd-executor.md ]` -- exists
2. `[ -f ~/.claude/skills/gsd-execute-phase/references/agents/gsd-verifier.md ]` -- exists
3. `wc -l ~/.claude/skills/gsd-execute-phase/references/agents/gsd-executor.md` -- approximately 400+ lines
4. `wc -l ~/.claude/skills/gsd-execute-phase/references/agents/gsd-verifier.md` -- approximately 500+ lines
5. `grep "gsd-tools" ~/.claude/skills/gsd-execute-phase/references/agents/gsd-executor.md` -- references gsd-tools.cjs
6. `grep "VERIFICATION" ~/.claude/skills/gsd-execute-phase/references/agents/gsd-verifier.md` -- creates VERIFICATION.md
  </verify>
  <done>
Two agent definition files exist at ~/.claude/skills/gsd-execute-phase/references/agents/ with core logic intact. Executor preserves per-task commit behavior (PIPE-03 deferred). Verifier preserves must_haves verification. Both agents read files from paths instead of expecting injected content.
  </done>
</task>

</tasks>

<verification>
1. Full directory structure exists:
   ```
   ~/.claude/skills/gsd-execute-phase/
     SKILL.md
     references/
       agents/
         gsd-executor.md
         gsd-verifier.md
   ```
2. SKILL.md frontmatter has: name, description, argument-hint, allowed-tools
3. SKILL.md body references both agents by absolute path
4. Executor agent preserves commit protocol, deviation rules, checkpoint handling
5. Verifier agent preserves verification methodology and VERIFICATION.md output
6. No content injection patterns in SKILL.md or agent files
</verification>

<success_criteria>
- gsd-execute-phase/SKILL.md exists with proper frontmatter and lean body (<1,500 tokens)
- 2 agent definitions live in references/agents/ (not standalone in ~/.claude/agents/)
- All agent spawns use absolute paths to references/agents/
- Executor agents receive plan paths (not content) -- TOKEN-01 satisfied
- SKILL.md body is lean orchestration -- TOKEN-02 satisfied
- allowed-tools explicitly listed -- PIPE-06 satisfied
- PIPE-03 structurally prepared but executor still commits per-task (Phase 3 will enforce)
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-skills-token-architecture/01-02-SUMMARY.md`
</output>
