---
phase: 07-prototype-driven-design-in-plan-phase-and-mandatory-frontend-verification-after-execution
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/nick-plan-phase/references/agents/nick-planner.md
  - skills/nick-plan-phase/references/agents/nick-plan-checker.md
autonomous: true
has_frontend: false

must_haves:
  truths:
    - "Planner agent creates static HTML/CSS prototype files for plans with frontend work"
    - "Planner agent sets has_frontend field in plan frontmatter based on files_modified and task intent"
    - "Plan checker validates prototype consistency -- has_frontend:true plans must have prototype file referenced"
    - "Prototype creation is scoped to 10-15% of planner context budget with ~150 line cap"
    - "Plans without frontend work skip prototype creation entirely"
  artifacts:
    - path: "skills/nick-plan-phase/references/agents/nick-planner.md"
      provides: "Planner agent with prototype_creation section, has_frontend detection, and updated plan_format"
      contains: "prototype_creation"
    - path: "skills/nick-plan-phase/references/agents/nick-plan-checker.md"
      provides: "Plan checker with prototype consistency verification dimension"
      contains: "Prototype Consistency"
  key_links:
    - from: "nick-planner.md <prototype_creation>"
      to: "nick-planner.md <plan_format>"
      via: "has_frontend and prototype frontmatter fields"
      pattern: "has_frontend"
    - from: "nick-plan-checker.md Dimension 8"
      to: "nick-planner.md <prototype_creation>"
      via: "validates prototype exists when has_frontend: true"
      pattern: "has_frontend.*true.*prototype"
---

<objective>
Add prototype-driven design capability to the planner agent and prototype consistency validation to the plan checker.

Purpose: The planner creates static HTML/CSS prototypes alongside PLAN.md files for frontend-touching plans. These prototypes provide visual specifications that guide executor implementation, reducing interpretation errors. The plan checker gains a new validation dimension ensuring prototypes exist when plans declare frontend work.

Output: Updated nick-planner.md with prototype_creation section and updated plan_format; updated nick-plan-checker.md with Dimension 8 (Prototype Consistency). Both synced to installed locations.
</objective>

<execution_context>
@/Users/nick/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nick/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-prototype-driven-design-in-plan-phase-and-mandatory-frontend-verification-after-execution/07-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add prototype creation and frontend detection to nick-planner.md</name>
  <files>
    skills/nick-plan-phase/references/agents/nick-planner.md
  </files>
  <action>
    Read the current nick-planner.md (repo copy at skills/nick-plan-phase/references/agents/nick-planner.md). Make three additions:

    **Addition 1: New `<prototype_creation>` XML section** -- Insert after `</tdd_integration>` and before `<gap_closure_mode>`. This section defines:

    - **When to create:** Any plan where `has_frontend: true` (plans that create/modify .tsx, .jsx, .html, .css, .scss files, or involve UI routes, pages, components, layouts, or visual styling).
    - **File naming:** `{phase}-{plan}-PROTOTYPE.html` in the phase directory alongside the PLAN.md.
    - **Prototype scope:** Layout structure, component hierarchy, placeholder data (realistic, not "Lorem ipsum"), interactive element states (buttons, inputs, empty/loading/error states), responsive breakpoints if relevant, colors/typography from project design system (check for tailwind.config, theme files).
    - **Prototype exclusions:** No JavaScript behavior, no framework-specific code (pure HTML/CSS only), no backend integration, no animations (describe in plan text instead).
    - **Size constraint:** Cap at ~150 lines of HTML. Spend 10-15% of planner context on prototypes, not 30-40%.
    - **Context budget:** If a plan has many visual elements, create a simpler prototype showing layout structure rather than every detail. The prototype is a guide, not a pixel-perfect spec.
    - **Prototype template:** Show the basic structure with DOCTYPE, head (title, viewport meta, inline style), body with semantic markup. Include a comment header: `<!-- Prototype for Plan {phase}-{plan}: {objective} -->`.

    **Addition 2: Update `<plan_format>` section** -- Add two optional fields to the frontmatter template:

    ```yaml
    has_frontend: false          # true if plan involves UI/visual files
    prototype: XX-NN-PROTOTYPE.html  # only if has_frontend: true
    ```

    Add these after the `autonomous` field and before `user_setup` in the template. Add them to the Frontmatter Fields table:

    | `has_frontend` | No | `true` if plan modifies .tsx/.jsx/.html/.css/.scss files or UI routes |
    | `prototype` | No | Prototype filename (only when `has_frontend: true`) |

    **Addition 3: Add frontend detection heuristic to `<break_into_tasks>` section** -- After the "User Setup Detection" subsection, add a "Frontend Detection" subsection:

    ```
    ## Frontend Detection

    For each plan, determine has_frontend:

    has_frontend = true if ANY of:
      - files_modified contains .tsx, .jsx, .html, .css, .scss
      - files_modified contains paths matching: src/app/**/page.tsx, src/components/**, pages/**
      - tasks involve UI components, layouts, pages, or visual styling
      - objective mentions "UI", "page", "component", "form", "dashboard", "layout"

    has_frontend = false if:
      - all files are .ts, .js, .json, .md, .yml, .yaml
      - work is pure backend, CLI, config, documentation, or infrastructure

    Self-check: If files_modified contains .tsx/.jsx/.html files, has_frontend SHOULD be true.
    The planner can override (e.g., a .tsx server-only component) but must be intentional.
    ```

    **Addition 4: Update `<execution_flow>` step `write_phase_prompt`** -- After "Write to `.planning/phases/XX-name/{phase}-{NN}-PLAN.md`", add:

    ```
    If the plan has `has_frontend: true`, also create the prototype file:
    Write to `.planning/phases/XX-name/{phase}-{NN}-PROTOTYPE.html`
    ```

    Do NOT modify any other sections. Preserve all existing content exactly.
  </action>
  <verify>
    Read the updated file and confirm:
    1. `<prototype_creation>` section exists between `</tdd_integration>` and `<gap_closure_mode>`
    2. `has_frontend` and `prototype` appear in the `<plan_format>` frontmatter template
    3. "Frontend Detection" subsection exists in `<break_into_tasks>`
    4. `write_phase_prompt` step mentions prototype file creation
    5. All existing sections are intact and unmodified
  </verify>
  <done>nick-planner.md has prototype_creation section with size constraints and format rules, updated plan_format with has_frontend/prototype fields, frontend detection heuristic in task breakdown, and prototype file creation in execution flow.</done>
</task>

<task type="auto">
  <name>Task 2: Add prototype consistency dimension to nick-plan-checker.md and sync both files</name>
  <files>
    skills/nick-plan-phase/references/agents/nick-plan-checker.md
    ~/.claude/skills/nick-plan-phase/references/agents/nick-planner.md
    ~/.claude/skills/nick-plan-phase/references/agents/nick-plan-checker.md
  </files>
  <action>
    **Part A: Update nick-plan-checker.md (repo copy)**

    Read the current nick-plan-checker.md at skills/nick-plan-phase/references/agents/nick-plan-checker.md. Add a new verification dimension inside `<verification_dimensions>`, after Dimension 7 (Context Compliance):

    ```
    ## Dimension 8: Prototype Consistency

    **Question:** Do frontend plans have prototypes, and do prototypes align with plan intent?

    **Only check for plans where `has_frontend: true` in frontmatter.**

    **Process:**
    1. Check if `has_frontend` field exists in plan frontmatter
    2. If `has_frontend: true`: verify `prototype` field references a file, and that file path follows the naming convention `{phase}-{plan}-PROTOTYPE.html`
    3. If `has_frontend: false` or absent: verify NO prototype field is set (avoid orphaned references)
    4. If prototype is referenced, check the prototype file exists in the phase directory

    **Red flags:**
    - `has_frontend: true` but no `prototype` field (visual spec missing for frontend plan)
    - `prototype` field set but `has_frontend` is false or absent (contradictory metadata)
    - Prototype filename does not match naming convention
    - files_modified contains .tsx/.jsx/.html/.css files but `has_frontend` is not true (planner may have missed detection)

    **Example issue:**
    ```yaml
    issue:
      dimension: prototype_consistency
      severity: warning
      description: "Plan 01 has has_frontend: true but no prototype field"
      plan: "01"
      fix_hint: "Add prototype: 07-01-PROTOTYPE.html and create the prototype file"
    ```
    ```

    Also update the success_criteria checklist to add: `- [ ] Prototype consistency checked (frontend plans have prototypes)`.

    **Part B: Sync both files to installed location**

    Copy the updated repo files to their installed locations:
    ```bash
    cp skills/nick-plan-phase/references/agents/nick-planner.md ~/.claude/skills/nick-plan-phase/references/agents/nick-planner.md
    cp skills/nick-plan-phase/references/agents/nick-plan-checker.md ~/.claude/skills/nick-plan-phase/references/agents/nick-plan-checker.md
    ```

    Verify sync with diff to confirm repo and installed files are identical.
  </action>
  <verify>
    1. `grep "Dimension 8" skills/nick-plan-phase/references/agents/nick-plan-checker.md` -- expect match
    2. `grep "prototype_consistency" skills/nick-plan-phase/references/agents/nick-plan-checker.md` -- expect match
    3. `grep "Prototype Consistency" skills/nick-plan-phase/references/agents/nick-plan-checker.md` -- expect match
    4. `diff skills/nick-plan-phase/references/agents/nick-planner.md ~/.claude/skills/nick-plan-phase/references/agents/nick-planner.md` -- expect no differences
    5. `diff skills/nick-plan-phase/references/agents/nick-plan-checker.md ~/.claude/skills/nick-plan-phase/references/agents/nick-plan-checker.md` -- expect no differences
  </verify>
  <done>Plan checker has Dimension 8 (Prototype Consistency) validating has_frontend/prototype field alignment. Both planner and checker synced to installed locations with identical content.</done>
</task>

</tasks>

<verification>
Phase-level checks for Plan 01:
1. `grep -c "prototype_creation" skills/nick-plan-phase/references/agents/nick-planner.md` returns at least 2 (section open/close tags)
2. `grep "has_frontend" skills/nick-plan-phase/references/agents/nick-planner.md` shows field in plan_format and detection heuristic
3. `grep "Dimension 8" skills/nick-plan-phase/references/agents/nick-plan-checker.md` returns match
4. Both repo files diff-clean against installed copies
5. Existing content in both files is preserved (no accidental deletions)
</verification>

<success_criteria>
- nick-planner.md has new prototype_creation section with clear scope constraints (150 line cap, 10-15% context)
- nick-planner.md plan_format includes has_frontend and prototype as optional frontmatter fields
- nick-planner.md break_into_tasks includes frontend detection heuristic
- nick-plan-checker.md has Dimension 8 validating prototype consistency
- Both files synced to ~/.claude/skills/ with identical content
- All existing content in both files preserved
</success_criteria>

<output>
After completion, create `.planning/phases/07-prototype-driven-design-in-plan-phase-and-mandatory-frontend-verification-after-execution/07-01-SUMMARY.md`
</output>
